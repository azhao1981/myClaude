---
name: tdd-workflow
description: 执行严格的测试驱动开发(TDD)流程。注意：适用于共享环境，严禁破坏性操作。
---

# TDD 工作流与数据原则

## 核心法则
1. **一目标一用例**: 每个开发目标只写一个测试用例。
2. **必须失败 (Red)**: 代码未完成前，测试用例必须报错。
3. **通过测试 (Green)**: 编写刚好能通过测试的最小代码。
4. **重构 (Refactor)**: 测试通过后优化结构。

## 数据安全禁令 (Data Safety - Treat Dev as Prod)
> **警告**: 当前环境被视为生产环境。严禁为了测试方便而重置环境。

- **禁止洗库**: 严禁使用 `TRUNCATE`, `DROP`, `DELETE FROM table` (不带具体ID) 等指令。
- **禁止全量清理**: 测试框架的 `setup` 和 `teardown` 阶段，**禁止**包含清空数据库的代码。
- **数据隔离策略**:
  - 测试数据必须使用 **唯一的随机 ID/Key** (如 UUID)，确保不与现有数据冲突。
  - 测试结束后，只清理**本次测试创建的**那几条特定数据（如果必须清理），不得触碰其他数据。
  - 优先使用事务回滚 (`Transaction Rollback`) 模式运行测试（如果框架支持）。

## 执行步骤
1. 分析需求，拆解为原子目标。
2. **检查环境**: 确认当前测试策略不会破坏现有数据。
3. 编写一个失败的测试用例（确保使用独立的测试数据ID）。
4. 运行测试确认失败。
5. 编写实现代码。
6. 再次运行测试确认通过。